<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<canvas id="game" width="400" height="400"></canvas>

<script>
    const $ = (s) => document.querySelector(s)
    const $$ = (s) => document.querySelectorAll(s)
    const on = (el,type,cb) => el.addEventListener(type,cb)

    class Grid {
        constructor(w,h) {
            this.w = w
            this.h = h
            this.data = new Array(10)
            for(let i=0; i<this.data.length; i++) {
                this.data[i] = new Array(10)
                for(let j=0; j<this.data[i].length; j++) {
                    this.data[i][j] = {
                        hidden:true,
                        mine:(Math.random()>0.9),
                        number:-1,
                        marked:false,
                    }
                }
            }
        }
        get(x,y) {
            return this.data[x][y]
        }
        reveal(x,y) {
            this.data[x][y].hidden = false
        }
        mark(x,y) {
            this.data[x][y].marked = !this.data[x][y].marked
        }
    }
    let data = new Grid(10,10)

    const SCALE = 30

    function count_adjacent_bombs(data, i, j) {
        return 2
    }

    function drawBoard(data, canvas) {
        let c = canvas.getContext('2d')
        c.fillStyle = 'white'
        c.fillRect(0,0,data.w*SCALE,data.h*SCALE)
        for(let i=0; i<data.w; i++) {
            for(let j=0; j<data.h; j++) {
                let cell = data.get(i,j)
                if(cell.marked) {
                    c.fillStyle = 'green'
                    c.fillRect(i * SCALE, j * SCALE, SCALE - 2, SCALE - 2)
                    continue;
                }
                if(cell.hidden) {
                    c.fillStyle = 'black'
                    c.fillRect(i * SCALE, j * SCALE, SCALE - 2, SCALE - 2)
                    continue;
                }
                if(cell.mine) {
                    c.fillStyle = 'red'
                    c.fillRect(i * SCALE, j * SCALE, SCALE - 2, SCALE - 2)
                    continue;
                }
                //if revealed and not a bomb, write number of adjacent cells that have a mine
                let count = count_adjacent_bombs(data,i,j)
                c.fillStyle = 'white'
                c.fillRect(i * SCALE, j * SCALE, SCALE - 2, SCALE - 2)
                c.fillStyle = 'black'
                c.fillText(count+"",i*SCALE+10,j*SCALE+15)
            }
        }
    }


    function redraw() {
        drawBoard(data,$("#game"))
    }

    on($("#game"),'click',(e)=>{
        let rect = e.target.getBoundingClientRect()
        let pt = {x:e.clientX - rect.x, y:e.clientY-rect.y}
        pt.x = Math.floor(pt.x/SCALE)
        pt.y = Math.floor(pt.y/SCALE)

        if(e.shiftKey) {
            data.reveal(pt.x, pt.y)
        } else {
            data.mark(pt.x,pt.y)
        }
        redraw()
    })


    redraw()
</script>

</body>
</html>